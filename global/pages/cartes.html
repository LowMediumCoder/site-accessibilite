<!DOCTYPE html>
<html>
	<head>
		<title>Cartes</title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
			crossorigin="anonymous" />
		<link
			rel="stylesheet"
			type="text/css"
			href="../css/style.css" />
	</head>
	<body>
		<div class="container mt-5">
			<h1 class="mb-4">Cartes</h1>
			<div></div>
			<a
				href="./accueil.html"
				class="btn btn-primary mb-4"
				>Accueil</a
			>
			<a
				href="./atelier.html"
				class="btn btn-primary mb-4"
				>Atelier</a
			>
			<a
				href="./contact.html"
				class="btn btn-primary mb-4"
				>Contact</a
			>

			<div class="row mb-4">
				<div class="col-md-4">
					<input
						type="text"
						class="form-control"
						placeholder="Search..."
						id="searchBar" />
				</div>
				<div class="col-md-1 text-start"></div>
				<div class="col-md-2">
					<div
						class="btn-group"
						role="group"></div>
				</div>
			</div>

			<div
				class="row"
				id="cardGrid"></div>
		</div>
		<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
		<script>
			const synth = window.speechSynthesis;
			document
				.getElementById("searchBar")
				.addEventListener("input", function () {
					const searchTerm = this.value.toLowerCase();
					const cards = document.querySelectorAll(".card-item");
					const activeCategory = document
						.querySelector(".btn-group .btn.btn-primary")
						?.getAttribute("data-category");

					cards.forEach((card) => {
						const title = card.dataset.title.toLowerCase();
						const matchesSearch = title.includes(searchTerm);
						const matchesCategory =
							!activeCategory ||
							card.getAttribute("data-category") === activeCategory;

						if (matchesSearch && matchesCategory) {
							card.style.display = "block";
						} else {
							card.style.display = "none";
						}
					});
				});

			function filterCards(category) {
				const searchTerm = document
					.getElementById("searchBar")
					.value.toLowerCase();
				const cards = document.querySelectorAll(".card-item");
				const buttons = document.querySelectorAll(".btn-group .btn");
				const activeButton = document.querySelector(
					`.btn-group .btn.btn-primary[data-category="${category}"]`
				);

				if (activeButton) {
					// If the clicked button is already active, remove the filter
					cards.forEach((card) => {
						const title = card.dataset.title.toLowerCase();
						if (title.includes(searchTerm)) {
							card.style.display = "block";
						} else {
							card.style.display = "none";
						}
					});
					buttons.forEach((button) => {
						button.classList.remove("btn-primary");
						button.classList.add("btn-secondary");
					});
				} else {
					// Apply the filter
					cards.forEach((card) => {
						const title = card.dataset.title.toLowerCase();
						const matchesSearch = title.includes(searchTerm);
						const matchesCategory =
							card.getAttribute("data-category") === category;

						if (matchesSearch && matchesCategory) {
							card.style.display = "block";
						} else {
							card.style.display = "none";
						}
					});
					buttons.forEach((button) => {
						if (button.getAttribute("data-category") === category) {
							button.classList.remove("btn-secondary");
							button.classList.add("btn-primary");
						} else {
							button.classList.remove("btn-primary");
							button.classList.add("btn-secondary");
						}
					});
				}
			}

			document.addEventListener("DOMContentLoaded", () => {
				fetch("../data/cartes.json")
					.then((response) => response.json())
					.then((data) => {
						const buttonGroup = document.querySelector(".btn-group");

						// Create a button for each famille using famille.titre
						data.familles.forEach((famille) => {
							const button = document.createElement("button");
							button.className = "btn btn-secondary me-2  rounded"; // Add 'me-2' to add margin to the end of each button
							button.setAttribute("data-category", famille.id);
							button.textContent = famille.titre; // Set text content to famille.titre
							button.onclick = () => filterCards(famille.id);
							buttonGroup.appendChild(button);
						});

						const cardGrid = document.getElementById("cardGrid");
						cardGrid.innerHTML = "";

						data.familles.forEach((famille) => {
							famille.cartes.forEach((carte) => {
								const card = document.createElement("div");
								card.className = "col-md-3 mb-4 card-item";
								card.setAttribute("data-category", famille.id);
								card.setAttribute("data-title", carte.titre);
								card.setAttribute("data-subtitle", carte.sousTitre);
								card.setAttribute("data-description", carte.description);
								card.setAttribute("data-image", `${carte.id}.png`);

								// Afficher uniquement l'image dans la carte
								card.innerHTML = `
			<div class="card h-100">
				<img src="../img/cartes/${carte.id}.png" class="card-img-top h-100" alt="${carte.titre}" />
				<div class="card-body">
					<h5 class="card-title">${carte.titre}</h5>
			</div>
		`;

								cardGrid.appendChild(card);
							});
						});

						// Ajouter des écouteurs d'événements aux images après l'ajout de toutes les cartes
						document.querySelectorAll(".card-item img").forEach((img) => {
							img.addEventListener("click", () => {
								const card = img.closest(".card-item");
								const title = card.dataset.title;
								const subTitle = card.dataset.subtitle;
								const description = card.dataset.description;

								// Création du modal avec uniquement l'image et le contenu de la carte
								const modal = document.createElement("div");
								modal.className = "modal fade";
								modal.tabIndex = -1;
								modal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">${title}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body text-center">
                        <img src="../img/cartes/${card.dataset.image}" class="img-fluid" alt="${title}" />
                        <h6>${subTitle}</h6>
                        <p>${description}</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                        <button type="button" class="btn btn-info">Lire la carte</button>
                    </div>
                </div>
            </div>
        `;

								document.body.appendChild(modal);
								const bootstrapModal = new bootstrap.Modal(modal);
								bootstrapModal.show();

								// Lecture de la carte
								modal
									.querySelector(".btn-info")
									.addEventListener("click", () => {
										const utterance = new SpeechSynthesisUtterance(
											`${title}. ${subTitle}. ${description}`
										);
										utterance.lang = "fr-FR";
										synth.speak(utterance);
									});
								document.addEventListener("keydown", (event) => {
									if (event.key === "Escape") {
										bootstrapModal.hide();
									}
								});
								document.addEventListener("keydown", (event) => {
									if (event.key === "p") {
										synth.cancel();
									}
								});

								// Suppression du modal après sa fermeture
								modal.addEventListener("hidden.bs.modal", () => {
									modal.remove();
								});
							});
						});

						document
							.querySelectorAll(
								"a, button, input, img, .btn-group .btn, .btn-info"
							)
							.forEach((element) => {
								element.addEventListener("mouseover", () => {
									cursorCircle.style.transform = "scale(2)";
									cursorCircle.style.backgroundColor = "rgba(0, 0, 0, 0.7)";
								});
								element.addEventListener("mouseleave", () => {
									cursorCircle.style.transform = "scale(1)";
									cursorCircle.style.backgroundColor = "rgba(0, 0, 0, 0.5)";
								});
							});
					})
					.catch((error) => console.error("Error fetching data:", error));
			});

			const cursorCircle = document.createElement("div");

			cursorCircle.style.zIndex = "9999";
			cursorCircle.style.position = "fixed";
			cursorCircle.style.width = "30px";
			cursorCircle.style.height = "30px";
			cursorCircle.style.borderRadius = "50%";
			cursorCircle.style.backgroundColor = "rgba(0, 0, 0, 0.5)";
			cursorCircle.style.pointerEvents = "none";
			cursorCircle.style.transition = "transform 0.2s ease";
			document.body.appendChild(cursorCircle);
			handleMouseMove = (event) => {
				const xoffset = 15;
				const yoffset = 15;
				const y = event.pageY;
				const x = event.pageX;
				const ref = cursorCircle;
				const scrollLeft =
					window.scrollX !== undefined
						? window.scrollX
						: (
								document.documentElement ||
								document.body.parentNode ||
								document.body
						  ).scrollLeft;
				const scrollTop =
					window.scrollY !== undefined
						? window.scrollY
						: (
								document.documentElement ||
								document.body.parentNode ||
								document.body
						  ).scrollTop;
				ref.style.left = x - scrollLeft - xoffset + "px";
				ref.style.top = y - scrollTop - yoffset + "px";
			};
			document.addEventListener("mousemove", handleMouseMove, false);
		</script>
	</body>
</html>
