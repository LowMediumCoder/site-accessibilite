<!DOCTYPE html>
<html lang="fr">

<head>
	<title>Cartes</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
	<link rel="stylesheet" type="text/css" href="../css/style.css" />
</head>

<body>
	<header>
		<!-- Desktop Navbar -->
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark d-none d-lg-block">
			<div class="container d-flex align-items-center">
				<a class="navbar-brand" href="accueil.html">
					<img src="/img/logo.png" alt="Sample image" class="img-fluid" width="69" height="69">
				</a>
				<div class="collapse navbar-collapse justify-content-center" id="navbarNav">
					<ul class="navbar-nav">
						<li class="nav-item">
							<a class="nav-link" aria-current="page" href="accueil.html">Accueil</a>
						</li>
						<li class="nav-item">
							<a class="nav-link active" href="cartes.html">Cartes</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="atelier.html">Atelier</a>
						</li>

						<li class="nav-item">
							<a class="nav-link" href="contact.html">Contact</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="a-propos.html">A propos</a>
						</li>
					</ul>
				</div>
				<label class="theme-switch">
					<input type="checkbox" id="checkbox">
					<span class="slider">
						<span class="slider-circle">
							<svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
								<circle cx="12" cy="12" r="4" />
								<line x1="12" y1="3" x2="12" y2="5" />
								<line x1="12" y1="19" x2="12" y2="21" />
								<line x1="5" y1="12" x2="3" y2="12" />
								<line x1="21" y1="12" x2="19" y2="12" />
								<line x1="6.36" y1="6.36" x2="4.94" y2="4.94" />
								<line x1="17.66" y1="17.66" x2="19.07" y2="19.07" />
								<line x1="6.36" y1="17.66" x2="4.94" y2="19.07" />
								<line x1="17.66" y1="6.36" x2="19.07" y2="4.94" />
							</svg>
							<svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
								<path d="M21 12.79A9 9 0 1 1 11.21 3 A7 7 0 0 0 21 12.79z" />
							</svg>
						</span>
					</span>
				</label>
			</div>
		</nav>

	</header>

	<!-- Mobile Sidebar Toggle -->
	<div class="position-absolute burger-menu-container d-lg-none">
		<button class="navbar-toggler mt-5" type="button" aria-label="Toggle navigation" aria-expanded="false"
			aria-controls="navsidebar">
			<div class="animated-icon" aria-hidden="true"><span class="burgerspan"></span><span
					class="burgerspan"></span><span class="burgerspan"></span></div>
		</button>
	</div>

	<!-- Mobile Sidebar -->
	<div class="d-flex flex-column flex-shrink-0 p-3 navsidebar d-lg-none" id="navsidebar" role="navigation"
		aria-label="Sidebar">
		<span class="fs-4 mt-5">Sidebar</span>
		<hr>
		<ul class="nav nav-pills flex-column mb-auto">
			<li class="nav-item">
				<a href="../pages/accueil.html" class="nav-link" aria-current="page">
					Accueil
				</a>
			</li>
			<li>
				<a href="../pages/cartes.html" class="nav-link active">
					Cartes
				</a>
			</li>
			<li>
				<a href="../pages/atelier.html" class="nav-link">
					Atelier
				</a>
			</li>
			<li>
				<a href="../pages/contact.html" class="nav-link">
					Contact
				</a>
			</li>
			<li>
				<a href="../pages/a-propos.html" class="nav-link">
					&Agrave; propos
				</a>
			</li>
		</ul>
		<hr>
		<label class="theme-switch">
			<input type="checkbox" id="checkboxmobile">
			<span class="slider">
				<span class="slider-circle">
					<svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
						<circle cx="12" cy="12" r="4" />
						<line x1="12" y1="3" x2="12" y2="5" />
						<line x1="12" y1="19" x2="12" y2="21" />
						<line x1="5" y1="12" x2="3" y2="12" />
						<line x1="21" y1="12" x2="19" y2="12" />
						<line x1="6.36" y1="6.36" x2="4.94" y2="4.94" />
						<line x1="17.66" y1="17.66" x2="19.07" y2="19.07" />
						<line x1="6.36" y1="17.66" x2="4.94" y2="19.07" />
						<line x1="17.66" y1="6.36" x2="19.07" y2="4.94" />
					</svg>
					<svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
						<path d="M21 12.79A9 9 0 1 1 11.21 3 A7 7 0 0 0 21 12.79z" />
					</svg>
				</span>
			</span>
		</label>
	</div>
	<main>
		<div class="hero-section d-flex align-items-center justify-content-center mb-5">
			<h1 class="hero-title fw-bold text-center position-relative">Notre jeu de cartes</h1>
		</div>
		<div class="container mt-5" style="width: 90%;">

			<button href="./cartes.html" class="button button-primary mb-4 visually-hidden-focusable fixed-top"
				id="skipToCards" tabindex="1">
				Passer directement aux cartes
			</button>
			<div class="d-flex filters justify-content-between mt-5 mb-4 w-100">
				<input type="text" class="form-control me-5 h-50 searchbar rounded-pill" placeholder="Rechercher..."
					id="searchBar" aria-label="Rechercher des cartes" />

				<div class="button-group col-12 col-lg-8 d-flex gap-2" role="group" aria-label="Filter buttons">
				</div>
			</div>
			<div class="alert alert-info p-4 mb-4 text-center d-none" role="alert">
				<p class="h4 mb-0" id="nameOfFamily"></p>
			</div>
			<h2 class="text-center mt-5 mb-5">Toutes les cartes</h2>
			<div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 gx-5 gy-5" id="cardGrid" role="list"></div>

		</div>
		<button class="button button-primary rounded-circle position-fixed bottom-0 end-0 m-4 d-none" id="scrollTopBtn"
			style="z-index: 1000; width: 50px; height: 50px; padding: 10px;" style="z-index: 1000;"
			aria-label="Retour en haut">
			<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-arrow-up"
				viewBox="0 0 16 16">
				<path fill-rule="evenodd"
					d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z" />
			</svg>
		</button>
	</main>
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
	<style>
		.filter-button {
			padding: 10px 20px;
			font-size: 1rem;
			font-weight: bold;
			transition: all 0.3s ease;
			border-radius: 25px;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.filter-button:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
		}


		@media (max-width: 768px) {
			.filter-button {
				padding: 8px 16px;
				font-size: 0.9rem;
			}
		}

		#cardGrid:focus {
			background-color: #207cc4;

		}

		@font-face {
			font-family: "Luciole";
			src: url("../fonts/Luciole-Regular.ttf");
		}

		#skipToCards {
			border-radius: 0 0 50px 50px;
		}

		.h-45 {
			height: 45%;
		}

		* {
			font-family: "Luciole", sans-serif;
			text-align: start;
		}

		*:focus-visible {
			outline: 6px solid #02007b !important;
		}

		.card-title {
			text-align: center;
		}


		.subTitle {
			font-weight: bold;
		}

		.card-img-top:focus {
			outline: 6px solid #02007b;
		}

		.bluebg {
			background-color: transparent;
			border: 0.2em solid #207cc4;
			color: #207cc4;
		}

		.bluebg:hover,
		.bluebg:focus,
		.bluebg.button-primary {
			background-color: #1a5f90;
			color: white !important;
		}

		.redbg {
			background-color: transparent;
			border: 0.2em solid #c0245c;
			color: #c0245c;
		}

		.redbg:hover,
		.redbg:focus,
		.redbg.button-primary {
			background-color: #8e1b45;
			color: white !important;
		}

		.greenbg {
			background-color: transparent;
			border: 0.2em solid #78c444;
			color: #78c444;
		}

		.greenbg:hover,
		.greenbg:focus,
		.greenbg.button-primary {
			background-color: #5c9333;
			color: white !important;
		}

		.orangebg {
			background-color: transparent;
			border: 0.2em solid #f09424;
			color: #f09424;
		}

		.orangebg:hover,
		.orangebg:focus,
		.orangebg.button-primary {
			background-color: #b36e1b;
			color: white !important;
		}

		.purplebg {
			background-color: transparent;
			border: 0.2em solid #68449c;
			color: #68449c;
		}

		.purplebg:hover,
		.purplebg:focus,
		.purplebg.button-primary {
			background-color: #4e3474;
			color: white !important;
		}

		@media (min-width: 1000px) {
			.subTitle {
				font-size: 1.4rem;
			}

			.description {
				font-size: 1.2rem;
			}
		}

		@media (max-width: 1000px) {
			.filters {
				flex-direction: column;
			}

			.modal-dialog {
				max-width: 100% !important;
			}

			.filter-button {
				margin-top: 1rem;
				font-size: 0.8rem;
			}

			#searchBar {
				width: 100% !important;
			}
		}
	</style>
	<footer class="py-5 bg-light">
		<div class="container">
			<div class="row align-items-center">
				<!-- Logo -->
				<div class="col-md-1">
					<img src="/img/logo.png" alt="Logo HandiScope" class="img-fluid" width="100">
				</div>

				<!-- Navigation -->
				<div class="col-md-9">
					<nav class="d-flex justify-content-around small">
						<a class="nav-link px-3" href="./credit.html">Crédits & Ressources</a>
						<a class="nav-link px-3" href="./mentions-legales.html">Mentions légales</a>
						<a class="nav-link px-3" href="./accessibilite.html">Accessibilité</a>
						<a class="nav-link px-3" href="./conditions.html">Conditions d'utilisation</a>
						<a class="nav-link px-3" href="./plan-site.html">Plan du site</a>
					</nav>
				</div>

				<!-- Back to top button -->
				<div class="col-md-2 text-end">
					<button onclick="window.scrollTo({top: 0, behavior: 'smooth'})"
						class="btn btn-pill text-white rounded-pill" style="background-color: #BD1D59;">
						↑ Retour en haut
					</button>
				</div>
			</div>

			<!-- Copyright -->
			<div class="row mt-4">
				<div class="col">
					<p class="mb-0 text-end">&copy; 2024 HandiScope. Tous droits réservés.</p>
				</div>
			</div>
		</div>
	</footer>

	<script src=" https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
		</script>
	<script src="../javascript/script.js"></script>
	<script>
		const synth = window.speechSynthesis;
		const cursorCircle = document.createElement("div");
		let activeFilter = document.querySelector(".button-group .button.button-primary")?.getAttribute("data-category");
		let isHovering = false;
		function initalizeScrollUpButton() {
			const scrollBtn = document.getElementById('scrollTopBtn');

			const toggleScrollBtn = () => {
				if (window.innerWidth < 1000) {
					scrollBtn.classList.remove('d-none');
					scrollBtn.classList.add('d-block');
				} else {
					scrollBtn.classList.remove('d-block');
					scrollBtn.classList.add('d-none');
				}
			};

			scrollBtn.addEventListener('click', () => {
				window.scrollTo({ top: 0, behavior: 'smooth' });
			});

			window.addEventListener('resize', toggleScrollBtn);
			toggleScrollBtn();

		}

		function initializeSearchBar() {
			document.getElementById("searchBar").addEventListener("input", function () {
				const searchTerm = this.value.toLowerCase();
				const cards = document.querySelectorAll(".card-item");
				const activeCategory = document.querySelector(".button-group .button.button-primary")?.getAttribute("data-category");
				let i = 0;
				cards.forEach((card) => {
					const title = card.dataset.title.toLowerCase();
					const id = card.dataset.image.slice(0, -4).toLowerCase();
					const matchesSearch = title.includes(searchTerm) || id.includes(searchTerm);
					const matchesCategory = !activeCategory || card.getAttribute("data-category") === activeCategory;

					if (matchesSearch && matchesCategory) {
						card.style.display = "block";
						card.querySelector("img").tabIndex = 0;
						card.setAttribute("data-id", i);
						i += 1;
					} else {
						card.style.display = "none";
						card.querySelector("img").tabIndex = -1;
						card.setAttribute("data-id", "");
					}
				});
			});
		}

		function filterCards(category) {
			const searchTerm = document.getElementById("searchBar").value.toLowerCase();
			const cards = document.querySelectorAll(".card-item");
			const buttons = document.querySelectorAll(".button-group .button");
			const activeButton = document.querySelector(`.button-group .button.button-primary[data-category="${category}"]`);
			activeFilter = category;

			if (activeButton) {
				// If the clicked button is already active, remove the filter
				cards.forEach((card) => {
					const title = card.dataset.title.toLowerCase();
					card.style.display = title.includes(searchTerm) ? "block" : "none";
				});

				// Reset all buttons
				buttons.forEach((button) => {
					button.classList.remove("button-primary");
					// Restore original colors based on background class
					if (button.classList.contains('bluebg')) {
						button.style.color = '#207cc4';
					} else if (button.classList.contains('redbg')) {
						button.style.color = '#c0245c';
					} else if (button.classList.contains('greenbg')) {
						button.style.color = '#78c444';
					} else if (button.classList.contains('orangebg')) {
						button.style.color = '#f09424';
					} else if (button.classList.contains('purplebg')) {
						button.style.color = '#68449c';
					}
				});
				activeFilter = null;
			} else {
				// Apply the filter
				cards.forEach((card) => {
					const title = card.dataset.title.toLowerCase();
					const matchesSearch = title.includes(searchTerm);
					const matchesCategory = card.getAttribute("data-category") === category;
					card.style.display = matchesSearch && matchesCategory ? "block" : "none";
				});

				// Update button styles
				buttons.forEach((button) => {
					if (button.getAttribute("data-category") === category) {
						button.classList.add("button-primary");
						button.style.color = 'white';
					} else {
						button.classList.remove("button-primary");
						// Restore original colors for inactive buttons
						if (button.classList.contains('bluebg')) {
							button.style.color = '#207cc4';
						} else if (button.classList.contains('redbg')) {
							button.style.color = '#c0245c';
						} else if (button.classList.contains('greenbg')) {
							button.style.color = '#78c444';
						} else if (button.classList.contains('orangebg')) {
							button.style.color = '#f09424';
						} else if (button.classList.contains('purplebg')) {
							button.style.color = '#68449c';
						}
					}
				});
			}

			let i = 0;
			cards.forEach((card) => {
				if (card.style.display === "block") {
					card.querySelector("img").tabIndex = 0;
					card.setAttribute("data-id", i);
					i += 1;
				} else {
					card.querySelector("img").tabIndex = -1;
					card.setAttribute("data-id", "");
				}
			});
		}

		function setupSkipButton() {
			const skipButton = document.getElementById("skipToCards");
			["click", "keydown"].forEach(function (e) {
				skipButton.addEventListener(e, () => {
					if (e === "keydown" && event.key !== "Enter") {
						return;
					}
					const firstVisibleCard = Array.from(document.querySelectorAll('.card-item')).find(card =>
						window.getComputedStyle(card).display !== 'none')?.querySelector('img');
					console.log(firstVisibleCard);
					if (firstVisibleCard) {
						firstVisibleCard.focus();
						firstVisibleCard.scrollIntoView();
					}
					skipButton.blur();
				});
			});
		}
		function displayFamilyName(familyName) {
			isHovering = true;
			const nameDiv = document.querySelector('#nameOfFamily');
			const alertDiv = nameDiv.parentElement;

			nameDiv.textContent = familyName;
			alertDiv.classList.remove('d-none');

			// Set colors based on family name
			if (familyName.toLowerCase().includes('journée')) {
				alertDiv.style.backgroundColor = '#207cc4';
				nameDiv.style.color = 'white';
			} else if (familyName.toLowerCase().includes('accessibilité')) {
				alertDiv.style.backgroundColor = '#c0245c';
				nameDiv.style.color = 'white';
			} else if (familyName.toLowerCase().includes('matériel')) {
				alertDiv.style.backgroundColor = '#f09424';
				nameDiv.style.color = 'white';
			} else if (familyName.toLowerCase().includes('numérique')) {
				alertDiv.style.backgroundColor = '#78c444';
				nameDiv.style.color = 'white';
			} else if (familyName.toLowerCase().includes('événements')) {
				alertDiv.style.backgroundColor = '#68449c';
				nameDiv.style.color = 'white';
			}
		}

		function updateDisplayedText() {
			const activeFamilyName = getActiveFamilyName();
			if (activeFamilyName) {
				displayFamilyName(activeFamilyName);
			} else {
				hideFamilyName();
			}
		}

		function getActiveFamilyName() {
			if (activeFilter) {
				console.log(activeFilter);
				const button = document.querySelector(`.filter-button[data-category="${activeFilter}"]`);
				return button ? button.getAttribute("familyName") : null;
			}
			return null;
		}

		let hideTimeout;

		function hideFamilyName() {
			isHovering = false;
			clearTimeout(hideTimeout);
			hideTimeout = setTimeout(() => {
				if (!activeFilter && !isHovering) {
					const nameDiv = document.querySelector('#nameOfFamily');
					nameDiv.parentElement.classList.add('d-none');
				}
			}, 1000);
		}

		function handleButtonHover() {
			isHovering = true;
			clearTimeout(hideTimeout);
		}
		function removeFocus() {
			console.log("remove focus");
			document.activeElement.blur();
		}

		function fetchAndDisplayCards() {
			fetch("../data/cartes.json")
				.then((response) => response.json())
				.then((data) => {
					const buttonGroup = document.querySelector(".button-group");

					// Create a button for each famille using famille.titre
					data.familles.forEach((famille) => {
						const button = document.createElement("button");
						button.className = "button button-secondary me-1 rounded-pill filter-button"; // Add 'me-2' to add margin to the end of each button
						button.setAttribute("data-category", famille.id);
						button.addEventListener("click", () => filterCards(famille.id));
						buttonGroup.appendChild(button);
						button.classList.add("filter-button");
						button.setAttribute("familyName", famille.titre);
						button.setAttribute("title", `Filtrer par ${famille.titre}`);
						if (famille.id == "organisation-de-la-journee") {
							button.classList.add("bluebg");
							button.dataset.originalBg = "bluebg";
							if (window.innerWidth >= 1000) {
								button.textContent = "Bleu";
							}
						}
						if (famille.id == "accessibilite-des-lieux") {
							button.classList.add("redbg");
							button.dataset.originalBg = "redbg";
							if (window.innerWidth >= 1000) {
								button.textContent = "Rouge";
							}
						}
						if (famille.id == "materiel") {
							button.classList.add("orangebg");
							button.dataset.originalBg = "orangebg";
							if (window.innerWidth >= 1000) {
								button.textContent = "Orange";
							}
						}
						if (famille.id == "numerique") {
							button.classList.add("greenbg");
							button.dataset.originalBg = "greenbg";
							if (window.innerWidth >= 1000) {
								button.textContent = "Vert";
							}
						}
						if (famille.id == "evenements-sociaux-professionnels") {
							button.classList.add("purplebg");
							button.dataset.originalBg = "purplebg";
							if (window.innerWidth >= 1000) {
								button.textContent = "Violet";
							}
						}
						button.addEventListener("mouseover", () => displayFamilyName(famille.titre));
						button.addEventListener("mouseout", updateDisplayedText);
						button.addEventListener("focus", () => displayFamilyName(famille.titre));
						button.addEventListener("mouseleave", () => removeFocus());
					});

					const cardGrid = document.getElementById("cardGrid");
					cardGrid.innerHTML = "";
					let i = 0;
					let previousfamily = "";
					let idNum = 0;
					data.familles.forEach((famille) => {
						famille.cartes.forEach((carte) => {
							if (previousfamily != famille.id) {
								idNum = 0;
							}
							idNum += 1;
							let addon = "";
							console.log(famille.id);
							if (famille.id == "organisation-de-la-journee") {
								addon = "BL";
							}
							if (famille.id == "accessibilite-des-lieux") {
								addon = "RO";
							}
							if (famille.id == "materiel") {
								addon = "OR";
							}
							if (famille.id == "numerique") {
								addon = "VE";
							}
							if (famille.id == "evenements-sociaux-professionnels") {
								addon = "VI";
							}
							const card = document.createElement("div");
							card.className = "col card-item";
							card.setAttribute("data-category", famille.id);
							card.setAttribute("data-title", carte.titre);
							card.setAttribute("data-subtitle", carte.sousTitre);
							card.setAttribute("data-description", carte.description);
							card.setAttribute("data-image", `${carte.id}-${addon}0${idNum}.png`);
							card.setAttribute("data-id", i);

							card.style.display = "block";
							i += 1;
							previousfamily = famille.id;

							// Afficher uniquement l'image dans la carte
							card.innerHTML = `
						<div class="card h-100" role="listitem" aria-labelledby="card-title-${carte.id}" aria-describedby="card-description-${carte.id}">
							<img src="../img/cartes_new/${carte.id}-${addon}0${idNum}.png" class="card-img-top h-100" alt="${carte.titre}" tabindex="0" aria-labelledby="card-title-${carte.id}" />

						</div>
					`;

							cardGrid.appendChild(card);
						});
					});

					// Ajouter des écouteurs d'événements aux images après l'ajout de toutes les cartes
					document.querySelectorAll(".card-item img").forEach((img) => {
						["click", "keydown"].forEach(function (e) {
							img.addEventListener(e, () => {
								if (e === "keydown" && event.key !== "Enter") {
									return;
								}
								const card = img.closest(".card-item");
								const title = card.dataset.title;
								const subTitle = card.dataset.subtitle;
								const description = card.dataset.description;
								const id = card.dataset.id;

								// Création du modal avec uniquement l'image et le contenu de la carte
								const modal = document.createElement("div");
								modal.className = "modal fade";
								modal.tabIndex = -1;
								modal.innerHTML = `
												<div class="modal-dialog modal-dialog-centered modal-xl" role="dialog" aria-labelledby="modalTitle" aria-describedby="modalDescription">
													<div class="modal-content">
														<div class="modal-header">
															<h5 class="modal-title" id="modalTitle">${title}</h5>
															<button type="button" class="button-close" data-bs-dismiss="modal" aria-label="Close"></button>
														</div>
														<div class="modal-body d-flex text-center" id="modalDescription">
															<div class="d-flex justify-content-between align-items-center w-100">
																<button type="button" class="button button-secondary me-2" id="prevCard" data-id="${id}" aria-label="Previous card">&#11164;</button>
																<div class="w-75 me-5">
																	<img src="../img/cartes_new/${card.dataset.image}" class="img-fluid" alt="${title}" />
																</div>
																<div class="w-50 ms-2">
																	<h6 class="subTitle">"${subTitle}"</h6>
																	<p class="description">${description}</p>
																</div>
																<button type="button" class="button button-secondary ms-2" id="nextCard" data-id="${id}" aria-label="Next card">&#11166;</button>
															</div>
														</div>
														<div class="modal-footer">
															<button type="button" class="button button-secondary" data-bs-dismiss="modal">Fermer</button>
															<button type="button" class="button button-info">Ecouter la carte</button>
														</div>
													</div>
												</div>
											`;

								document.body.appendChild(modal);
								const bootstrapModal = new bootstrap.Modal(modal);
								bootstrapModal.show();

								// Lecture de la carte
								modal.querySelector(".button-info").addEventListener("click", () => {
									const utterance = new SpeechSynthesisUtterance(`${title}. ${subTitle}. ${description}`);
									utterance.lang = "fr-FR";
									synth.speak(utterance);
								});
								modal.querySelectorAll("button").forEach((button) => {
									addEventToCursorCircle(button);
								});
								modal.querySelectorAll("#nextCard, #prevCard").forEach((button) => {
									button.addEventListener("click", () => {
										handleCardNavigation(button.id === "nextCard" ? "next" : "prev", parseInt(button.dataset.id));
									});
								});
								document.addEventListener("keydown", (event) => {
									if (event.key === "Escape") {
										bootstrapModal.hide();
									}
								});
								document.addEventListener("keydown", (event) => {
									if (event.key === "p") {
										synth.cancel();
									}
								});

								// Suppression du modal après sa fermeture
								modal.addEventListener("hidden.bs.modal", () => {
									modal.remove();
								});
							});
						});
					});

					document.querySelectorAll("a, button, input, img, .button-group .button, .button-info").forEach((element) => {
						addEventToCursorCircle(element);
					});
				})
				.catch((error) => console.error("Error fetching data:", error));
		}

		function handleCardNavigation(direction, id) {
			const allcards = document.querySelectorAll(".card-item");
			const cards = Array.from(allcards).filter((card) => card.style.display === "block");
			const modal = document.querySelector(".modal");
			const nextCard = direction === "next" ? id + 1 : id - 1;
			const card = cards[nextCard];
			if (card) {
				const title = card.dataset.title;
				const subTitle = card.dataset.subtitle;
				const description = card.dataset.description;
				const image = card.dataset.image;
				const id = card.dataset.id;

				modal.querySelector(".modal-title").textContent = title;
				modal.querySelector("img").src = `../img/cartes_new/${image}`;
				modal.querySelector("img").alt = title;
				modal.querySelector("h6").textContent = subTitle;
				modal.querySelector("p").textContent = description;
				modal.querySelector("#nextCard").dataset.id = id;
				modal.querySelector("#prevCard").dataset.id = id;
			} else {
				if (direction === "next") {
					const title = cards[0].dataset.title;
					const subTitle = cards[0].dataset.subtitle;
					const description = cards[0].dataset.description;
					const image = cards[0].dataset.image;
					const id = cards[0].dataset.id;

					modal.querySelector(".modal-title").textContent = title;
					modal.querySelector("img").src = `../img/cartes_new/${image}`;
					modal.querySelector("img").alt = title;
					modal.querySelector("h6").textContent = subTitle;
					modal.querySelector("p").textContent = description;
					modal.querySelector("#nextCard").dataset.id = id;
					modal.querySelector("#prevCard").dataset.id = id;
				} else {
					const title = cards[cards.length - 1].dataset.title;
					const subTitle = cards[cards.length - 1].dataset.subtitle;
					const description = cards[cards.length - 1].dataset.description;
					const image = cards[cards.length - 1].dataset.image;
					const id = cards[cards.length - 1].dataset.id;

					modal.querySelector(".modal-title").textContent = title;
					modal.querySelector("img").src = `../img/cartes_new/${image}`;
					modal.querySelector("img").alt = title;
					modal.querySelector("h6").textContent = subTitle;
					modal.querySelector("p").textContent = description;
					modal.querySelector("#nextCard").dataset.id = id;
					modal.querySelector("#prevCard").dataset.id = id;
				}
			}
		}

		function addEventToCursorCircle(element) {
			element.addEventListener("mouseover", () => {
				element.style.cursor = "pointer";
				cursorCircle.style.transform = "scale(2)";
				cursorCircle.style.backgroundColor = "rgba(0, 0, 0, 0.7)";
			});
			element.addEventListener("mouseleave", () => {
				cursorCircle.style.transform = "scale(1)";
				cursorCircle.style.backgroundColor = "rgba(0, 0, 0, 0.5)";
			});
		}

		function setupCursorCircle() {
			cursorCircle.style.cssText = `
						z-index: 9999;
						position: fixed;
						width: 30px;
						height: 30px;
						border-radius: 50%;
						background-color: rgba(0, 0, 0, 0.5);
						pointer-events: none;
						transition: transform 0.2s ease;
					`;
			document.body.appendChild(cursorCircle);

			function handleMouseMove(event) {
				const xoffset = 15;
				const yoffset = 15;
				const y = event.pageY;
				const x = event.pageX;
				const ref = cursorCircle;
				const scrollLeft = window.scrollX !== undefined ? window.scrollX : (document.documentElement || document.body.parentNode || document.body).scrollLeft;
				const scrollTop = window.scrollY !== undefined ? window.scrollY : (document.documentElement || document.body.parentNode || document.body).scrollTop;
				ref.style.left = x - scrollLeft - xoffset + "px";
				ref.style.top = y - scrollTop - yoffset + "px";
			}

			document.addEventListener("mousemove", handleMouseMove, false);
			document.addEventListener("mouseleave", () => {
				cursorCircle.style.display = "none";
			});
			document.addEventListener("mouseenter", () => {
				cursorCircle.style.display = "block";
			});
		}

		function handleKeyEvents() {
			document.addEventListener("keydown", (event) => {
				const modal = document.querySelector(".modal");
				if (modal) {
					if (event.key === "ArrowLeft") {
						const id = parseInt(modal.querySelector("#prevCard").dataset.id);
						handleCardNavigation("prev", id);
					}
					if (event.key === "ArrowRight") {
						const id = parseInt(modal.querySelector("#nextCard").dataset.id);
						handleCardNavigation("next", id);
					}
				}
			});
		}

		// Initialize functions on DOMContentLoaded
		document.addEventListener("DOMContentLoaded", () => {
			initalizeScrollUpButton();
			setupCursorCircle();
			initializeSearchBar();
			setupSkipButton();
			fetchAndDisplayCards();
			handleKeyEvents();
		});
	</script>


	<script src=" https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
		</script>
	<script src="../javascript/script.js"></script>
</body>

</html>