<!DOCTYPE html>
<html>
	<head>
		<title>Cartes</title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
			crossorigin="anonymous" />
		<link
			rel="stylesheet"
			type="text/css"
			href="../css/style.css" />
	</head>
	<body>
		<div class="container mt-5">
			<h1 class="mb-4">Cartes</h1>
			<div class="row mb-4">
				<div class="col-md-6">
					<input
						type="text"
						class="form-control"
						placeholder="Search..."
						id="searchBar" />
				</div>
				<div class="col-md-4 text-end">
					<div
						class="btn-group"
						role="group"></div>
				</div>
			</div>
			<div
				class="row"
				id="cardGrid"></div>
		</div>
		<script>
			document
				.getElementById("searchBar")
				.addEventListener("input", function () {
					const searchTerm = this.value.toLowerCase();
					const cards = document.querySelectorAll(".card-item");
					cards.forEach((card) => {
						const title = card
							.querySelector(".card-title")
							.textContent.toLowerCase();
						if (title.includes(searchTerm)) {
							card.style.display = "block";
						} else {
							card.style.display = "none";
						}
					});
				});

			function filterCards(category) {
				const cards = document.querySelectorAll(".card-item");
				const buttons = document.querySelectorAll(".btn-group .btn");
				const activeButton = document.querySelector(
					`.btn-group .btn.btn-primary[data-category="${category}"]`
				);

				if (activeButton) {
					// If the clicked button is already active, remove the filter
					cards.forEach((card) => {
						card.style.display = "block";
					});
					buttons.forEach((button) => {
						button.classList.remove("btn-primary");
						button.classList.add("btn-secondary");
					});
				} else {
					// Apply the filter
					cards.forEach((card) => {
						if (card.getAttribute("data-category") === category) {
							card.style.display = "block";
						} else {
							card.style.display = "none";
						}
					});
					buttons.forEach((button) => {
						if (button.getAttribute("data-category") === category) {
							button.classList.remove("btn-secondary");
							button.classList.add("btn-primary");
						} else {
							button.classList.remove("btn-primary");
							button.classList.add("btn-secondary");
						}
					});
				}
			}

			document.addEventListener("DOMContentLoaded", () => {
				fetch("../data/cartes.json")
					.then((response) => response.json())
					.then((data) => {
						const buttonGroup = document.querySelector(".btn-group");

						// Create a button for each famille using famille.titre
						data.familles.forEach((famille) => {
							const button = document.createElement("button");
							button.className = "btn btn-secondary";
							button.setAttribute("data-category", famille.id);
							button.textContent = famille.titre; // Set text content to famille.titre
							button.onclick = () => filterCards(famille.id);
							buttonGroup.appendChild(button);
						});

						const cardGrid = document.getElementById("cardGrid");
						cardGrid.innerHTML = "";

						data.familles.forEach((famille) => {
							famille.cartes.forEach((carte) => {
								const card = document.createElement("div");
								card.className = "col-md-3 mb-4 card-item";
								card.setAttribute("data-category", famille.id);

								card.innerHTML = `
						<div class="card h-100">
							<img src="../img/cartes/${carte.id}.png" class="card-img-top" alt="${carte.titre}" />
							<div class="card-body">
								<h5 class="card-title">${carte.titre}</h5>
								<h6 class="card-body">"${carte.sousTitre}"</h6>
								<p class="card-text">${carte.description}</p>
							</div>
						</div>
					`;

								cardGrid.appendChild(card);
							});
						});
					})
					.catch((error) => console.error("Error fetching data:", error));
			});
		</script>
	</body>
</html>
